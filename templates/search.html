{% extends "base.html" %}

{% block title %}Tìm kiếm: {{ query }} - ReviewChill{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <div class="search-header mb-4">
                <h2 class="text-white fw-bold">
                    <i class="fas fa-search text-warning me-2"></i>
                    Kết quả tìm kiếm
                </h2>
                <p class="text-muted">
                    Tìm thấy {{ reviews|length }} kết quả
                    {% if query %} cho: <span class="text-warning fw-bold">"{{ query }}"</span>{% endif %}
                    {% if countries and selected_country and selected_country != 'all' %} - {{ selected_country }}{% endif %}
                    {% if genres and selected_genre and selected_genre != 'all' %} - {{ selected_genre }}{% endif %}
                </p>
            </div>

            <!-- Search Results -->
            {% if reviews %}
                <div class="row">
                    {% for review in reviews %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="review-card">
                            <div class="review-thumbnail">
                                {% if review[5] == 'youtube' %}
                                    <img src="https://img.youtube.com/vi/{{ review[6] }}/maxresdefault.jpg" 
                                         alt="{{ review[1] }}" class="img-fluid">
                                    <div class="play-button">
                                        <i class="fab fa-youtube"></i>
                                    </div>
                                {% elif review[5] == 'facebook' %}
                                    <div class="facebook-thumbnail">
                                        <i class="fab fa-facebook-square text-primary display-3"></i>
                                        <div class="play-button">
                                            <i class="fab fa-facebook"></i>
                                        </div>
                                    </div>
                                {% endif %}
                                
                                <!-- Rating Badge -->
                                <div class="rating-badge">
                                    <i class="fas fa-star"></i>
                                    {{ review[8] }}/10
                                </div>
                            </div>
                            
                            <div class="review-content">
                                <h5 class="review-title">{{ review[1] }}</h5>
                                <p class="movie-title">
                                    <i class="fas fa-film me-1"></i>
                                    {{ review[2] }}
                                    {% if review|length > 14 and review[14] == 'series' and review[13] %}
                                        <span class="badge bg-primary ms-1">Tập {{ review[13] }}</span>
                                    {% endif %}
                                </p>
                                <p class="reviewer-name">
                                    <i class="fas fa-user me-1"></i>
                                    {{ review[3] }}
                                </p>
                                
                                <!-- Thông tin phân loại -->
                                <div class="movie-meta mb-2">
                                    {% if review|length > 11 and review[11] and review[11] != 'Unknown' %}
                                        <span class="badge bg-warning text-dark me-1">
                                            <i class="fas fa-globe me-1"></i>{{ review[11] }}
                                        </span>
                                    {% endif %}
                                    {% if review|length > 12 and review[12] and review[12] != 'Unknown' %}
                                        <span class="badge bg-info me-1">
                                            <i class="fas fa-tags me-1"></i>{{ review[12] }}
                                        </span>
                                    {% endif %}
                                    {% if review|length > 14 and review[14] == 'series' %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-tv me-1"></i>Phim bộ
                                        </span>
                                    {% endif %}
                                </div>
                                
                                <p class="review-description">{{ review[7][:100] }}...</p>
                                
                                <div class="review-actions">
                                    <a href="{{ url_for('review_detail', review_id=review[0]) }}" 
                                       class="btn btn-warning btn-sm">
                                        <i class="fas fa-play me-1"></i>Xem Video
                                    </a>
                                    {% if review|length > 14 and review[14] == 'series' and review[12] %}
                                        <a href="{{ url_for('series_detail', series_name=review[12]) }}" 
                                           class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-list me-1"></i>Xem bộ
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="review-meta">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    {{ review[10] }}
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <!-- No Results -->
                <div class="no-results">
                    <div class="text-center py-5">
                        <i class="fas fa-search display-1 text-muted mb-4"></i>
                        <h3 class="text-white mb-3">Không tìm thấy kết quả</h3>
                        <p class="text-muted mb-4">
                            Không tìm thấy video review nào phù hợp với từ khóa 
                            <span class="text-warning">"{{ query }}"</span>
                        </p>
                        
                        <div class="search-suggestions">
                            <h5 class="text-white mb-3">Gợi ý tìm kiếm:</h5>
                            <ul class="list-unstyled text-muted">
                                <li class="mb-2">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    Thử sử dụng từ khóa ngắn gọn hơn
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    Kiểm tra chính tả của từ khóa
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    Thử tìm kiếm bằng tên phim hoặc reviewer
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    Sử dụng từ khóa tiếng Anh cho phim Hollywood
                                </li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <a href="{{ url_for('index') }}" class="btn btn-warning me-3">
                                <i class="fas fa-home me-1"></i>Về trang chủ
                            </a>
                            
                            <!-- Popular search suggestions -->
                            <div class="popular-searches mt-4">
                                <h6 class="text-white mb-3">Tìm kiếm phổ biến:</h6>
                                <div class="d-flex flex-wrap gap-2">
                                    <a href="{{ url_for('search') }}?q=Avengers" class="btn btn-outline-warning btn-sm">
                                        Avengers
                                    </a>
                                    <a href="{{ url_for('search') }}?q=Marvel" class="btn btn-outline-warning btn-sm">
                                        Marvel
                                    </a>
                                    <a href="{{ url_for('search') }}?q=Spider-Man" class="btn btn-outline-warning btn-sm">
                                        Spider-Man
                                    </a>
                                    <a href="{{ url_for('search') }}?q=Fast" class="btn btn-outline-warning btn-sm">
                                        Fast & Furious
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Advanced Search Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="advanced-search-card">
                <h5 class="text-white mb-3">
                    <i class="fas fa-filter text-warning me-2"></i>
                    Tìm kiếm nâng cao
                </h5>
                
                <form action="{{ url_for('search') }}" method="GET" class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label text-white">Từ khóa</label>
                        <input type="text" class="form-control" name="q" value="{{ query }}" 
                               placeholder="Nhập tên phim, reviewer...">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label text-white">Quốc gia</label>
                        <select class="form-select" name="country">
                            <option value="">Tất cả</option>
                            {% if countries %}
                                {% for country in countries %}
                                    <option value="{{ country }}" {% if selected_country == country %}selected{% endif %}>
                                        {{ country }}
                                    </option>
                                {% endfor %}
                            {% else %}
                                <option value="Mỹ">Mỹ</option>
                                <option value="Hàn Quốc">Hàn Quốc</option>
                                <option value="Trung Quốc">Trung Quốc</option>
                                <option value="Việt Nam">Việt Nam</option>
                            {% endif %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label text-white">Thể loại</label>
                        <select class="form-select" name="genre">
                            <option value="">Tất cả</option>
                            {% if genres %}
                                {% for genre in genres %}
                                    <option value="{{ genre }}" {% if selected_genre == genre %}selected{% endif %}>
                                        {{ genre }}
                                    </option>
                                {% endfor %}
                            {% else %}
                                <option value="Hành động">Hành động</option>
                                <option value="Kinh dị">Kinh dị</option>
                                <option value="Khoa học viễn tưởng">Khoa học viễn tưởng</option>
                                <option value="Tình cảm">Tình cảm</option>
                                <option value="Hài">Hài</option>
                            {% endif %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label text-white">Đánh giá</label>
                        <select class="form-select" name="rating">
                            <option value="">Tất cả</option>
                            <option value="9">9+ điểm</option>
                            <option value="8">8+ điểm</option>
                            <option value="7">7+ điểm</option>
                            <option value="6">6+ điểm</option>
                        </select>
                    </div>
                    <div class="col-md-1">
                        <label class="form-label text-white">&nbsp;</label>
                        <button type="submit" class="btn btn-warning w-100">
                            <i class="fas fa-search me-1"></i>Tìm
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Back Navigation -->
    <div class="row mt-4">
        <div class="col-12">
            <a href="{{ url_for('index') }}" class="btn btn-outline-warning">
                <i class="fas fa-arrow-left me-1"></i>
                Trở về trang chủ
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Highlight search terms in results
    const searchTerm = '{{ query }}';
    if (searchTerm) {
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        document.querySelectorAll('.review-title, .movie-title, .reviewer-name').forEach(element => {
            element.innerHTML = element.innerHTML.replace(regex, '<mark class="bg-warning text-dark">$1</mark>');
        });
    }
    
    // Add hover effects to review cards
    document.querySelectorAll('.review-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>
{% endblock %}